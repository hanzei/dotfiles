- name: Symlink dotfiles from nested directories
  hosts: localhost
  connection: local
  become: false
  vars:
    dotfiles_repo: "{{ ansible_env.HOME }}/dotfiles"
    dotfiles_map:
    - src: git/.gitconfig
      dest: "{{ ansible_env.HOME }}/.gitconfig"
    - src: git/ .gitignore_global
      dest: "{{ ansible_env.HOME }}/.gitignore_global"
    - src: zsh/.zshrc
      dest: "{{ ansible_env.HOME }}/.zshrc"

  tasks:
  - name: Ensure parent directories exist
    file:
      path: "{{ item.dest | dirname }}"
      state: directory
      mode: '0755'
    loop: "{{ dotfiles_map }}"
    loop_control:
      label: "{{ item.dest }}"

  - name: Create symlinks for nested dotfiles
    file:
      src: "{{ dotfiles_repo }}/{{ item.src }}"
      dest: "{{ item.dest }}"
      state: link
      force: true
      follow: false
    loop: "{{ dotfiles_map }}"
    loop_control:
      label: "{{ item.dest }}"
